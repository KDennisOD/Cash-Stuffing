<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Cash Stuffing</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="{{ url_for('static', filename='app.js') }}" defer></script>
</head>
<body>
    <h1>Cash Stuffing</h1>
    
    {% if categories %}
        <div id="summary">
            <p>Gesamtbetrag: {{ categories | sum(attribute='allocated_amount') | round(2) }} €</p>
            <p>Zugewiesen: {{ categories | sum(attribute='allocated_amount') | round(2) }} €</p>
            <p>Ausgaben: {{ categories | sum(attribute='spent_amount') | round(2) }} €</p>
            <p>Verfügbar: {{ (categories | sum(attribute='allocated_amount') - categories | sum(attribute='spent_amount')) | round(2) }} €</p>
        </div>
    
        <div id="budgetList">
            <!-- Kategorien werden hier dynamisch eingefügt -->
            {% for category in categories %}
                <div class="budget-item">
                    <h3>
                        <i class="{{ category.icon }}"></i> {{ category.name }}
                        <a href="{{ url_for('delete_category', category_id=category.id) }}" class="delete-btn" title="Kategorie löschen">&times;</a>
                    </h3>
                    <div class="category-details">
                        <p>Zugewiesen: {{ category.allocated_amount | round(2) }} €</p>
                        <p>Ausgegeben: {{ category.spent_amount | round(2) }} €</p>
                        <p>Verfügbar: {{ (category.allocated_amount - category.spent_amount) | round(2) }} €</p>
                    </div>
                    <div class="add-expense-form">
                        <input type="text" id="expenseDescription{{ category.id }}" placeholder="Ausgabenbeschreibung">
                        <input type="number" id="expenseAmount{{ category.id }}" placeholder="Betrag (€)" min="0" step="0.01">
                        <button onclick="addExpenseUI({{ category.id }})">Ausgabe hinzufügen</button>
                        <br>
                        <label>Kassenzettel scannen:</label>
                        <input type="file" accept="image/*" capture="environment" onchange="scanReceipt(event, {{ category.id }})">
                    </div>
                    <ul class="expense-list" id="expenseList{{ category.id }}">
                        {% for expense in category.expenses %}
                            <li class="expense-item">
                                <span>{{ expense.description }}: {{ expense.amount | round(2) }} €</span>
                                <button class="expense-delete-btn" onclick="deleteExpenseUI({{ category.id }}, {{ expense.id }})" title="Ausgabe löschen">&times;</button>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            {% endfor %}
        </div>
    
        <div id="addCategorySection">
            <h2>Neue Kategorie hinzufügen</h2>
            <form id="addCategoryForm">
                <label for="categoryName">Kategorie Name:</label>
                <input type="text" id="categoryName" name="categoryName" required>
                <br>
                <label for="categoryAmount">Zugewiesener Betrag (€):</label>
                <input type="number" id="categoryAmount" name="categoryAmount" min="0" step="0.01" required>
                <br>
                <label for="categoryIcon">Icon-Klasse:</label>
                <input type="text" id="categoryIcon" name="categoryIcon" placeholder="z.B. fas fa-car">
                <br>
                <button type="submit">Kategorie hinzufügen</button>
            </form>
        </div>
    
        <a href="{{ url_for('logout') }}">Logout</a>
    {% else %}
        <p>Willkommen bei Cash Stuffing! Bitte <a href="{{ url_for('login') }}">melden Sie sich an</a> oder <a href="{{ url_for('register') }}">registrieren Sie sich</a>.</p>
        
        <div id="addCategorySection">
            <h2>Neue Kategorie hinzufügen</h2>
            <form id="addCategoryForm">
                <label for="categoryName">Kategorie Name:</label>
                <input type="text" id="categoryName" name="categoryName" required>
                <br>
                <label for="categoryAmount">Zugewiesener Betrag (€):</label>
                <input type="number" id="categoryAmount" name="categoryAmount" min="0" step="0.01" required>
                <br>
                <label for="categoryIcon">Icon-Klasse:</label>
                <input type="text" id="categoryIcon" name="categoryIcon" placeholder="z.B. fas fa-car">
                <br>
                <button type="submit">Kategorie hinzufügen</button>
            </form>
        </div>
    {% endif %}
    
    <div id="processingOverlay" style="display: none;">
        <div class="overlay-content">
            <p>Verarbeite...</p>
        </div>
    </div>
</body>
</html>
